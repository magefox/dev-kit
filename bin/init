#!/bin/bash

green=$(tput setaf 2)
blue=$(tput setaf 4)
normal=$(tput sgr0)

if [ -f .env ]; then
    source .env
    echo "${green}Preparing source code ...${normal}"

    if [ -n "$GIT_URL" ]; then
        rm -rf src/
        git clone $GIT_URL src
    fi

    if [ -n "$GIT_BRANCH" ]; then
        cd src/
        git checkout $GIT_BRANCH
        cd ..
    fi

    echo "${green}Starting docker containers ...${normal}"
    bin/docker stop
    bin/docker start
    bin/docker php composer install
    bin/magento setup:install --base-url="${BASE_URL}" --db-host="db" --db-name="${DATABASE}" --db-user="root" --db-password="magento" --backend-frontname="admin" --admin-firstname="Admin" --admin-lastname="Admin" --admin-user="admin" --admin-password="admin123" --admin-email="admin@localhost.com" --use-rewrites="1" --elasticsearch-host=elasticsearch
else
	echo "No .env file found."
fi